### Task

Rewrite the code to use a spinlock instead of a condition variable.

